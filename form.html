<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Premium Order Form - Mr. Bhusal</title>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            background: linear-gradient(-45deg, #0f172a, #1e3a8a, #0369a1, #0c4a6e);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            padding: 12px;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .container {
            width: 100%;
            max-width: 1024px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            padding: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            position: relative;
        }

        @media (min-width: 640px) {
            .container {
                padding: 24px;
                border-radius: 32px;
            }
            body {
                padding: 16px;
            }
        }

        @media (min-width: 1024px) {
            .container {
                padding: 48px;
            }
            body {
                padding: 32px;
            }
        }

        .home-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #0ea5e9, #2563eb);
            color: white;
            padding: 6px 8px;
            border-radius: 20px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            border: none;
            cursor: pointer;
        }

        @media (min-width: 640px) {
            .home-btn {
                top: 16px;
                right: 16px;
                padding: 8px 12px;
                gap: 8px;
                font-size: 14px;
            }
        }

        @media (min-width: 1024px) {
            .home-btn {
                top: 24px;
                right: 24px;
                padding: 8px 16px;
                font-size: 16px;
            }
        }

        .home-btn:hover {
            background: linear-gradient(135deg, #0284c7, #1d4ed8);
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.25);
        }

        .home-icon {
            width: 12px;
            height: 12px;
        }

        @media (min-width: 640px) {
            .home-icon {
                width: 16px;
                height: 16px;
            }
        }

        @media (min-width: 1024px) {
            .home-icon {
                width: 20px;
                height: 20px;
            }
        }

        .title {
            font-size: 20px;
            font-weight: bold;
            background: linear-gradient(135deg, #0ea5e9, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-align: center;
            margin-bottom: 24px;
            padding: 0 16px;
        }

        @media (min-width: 640px) {
            .title {
                font-size: 24px;
                margin-bottom: 32px;
            }
        }

        @media (min-width: 1024px) {
            .title {
                font-size: 36px;
                margin-bottom: 48px;
            }
        }

        .steps {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 24px;
            gap: 4px;
            padding: 0 8px;
        }

        @media (min-width: 640px) {
            .steps {
                justify-content: space-around;
                margin-bottom: 32px;
                gap: 8px;
            }
        }

        @media (min-width: 1024px) {
            .steps {
                margin-bottom: 48px;
                gap: 16px;
            }
        }

        .step {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        @media (min-width: 640px) {
            .step {
                flex: none;
            }
        }

        .step-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.5s ease;
            cursor: pointer;
        }

        @media (min-width: 640px) {
            .step-icon {
                width: 48px;
                height: 48px;
            }
        }

        @media (min-width: 1024px) {
            .step-icon {
                width: 64px;
                height: 64px;
            }
        }

        @media (min-width: 1280px) {
            .step-icon {
                width: 80px;
                height: 80px;
            }
        }

        .step-icon.active {
            background: linear-gradient(135deg, #2563eb, #0ea5e9);
            color: white;
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.5);
            transform: scale(1.1);
        }

        .step-icon.current {
            animation: pulse 2s infinite;
            box-shadow: 0 0 0 8px rgba(14, 165, 233, 0.5);
        }

        @media (min-width: 640px) {
            .step-icon.current {
                box-shadow: 0 0 0 16px rgba(14, 165, 233, 0.5);
            }
        }

        .step-icon.inactive {
            background: rgba(255, 255, 255, 0.1);
            color: #cbd5e1;
        }

        .step-icon.inactive:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .step-icon svg {
            width: 16px;
            height: 16px;
        }

        @media (min-width: 640px) {
            .step-icon svg {
                width: 20px;
                height: 20px;
            }
        }

        @media (min-width: 1024px) {
            .step-icon svg {
                width: 24px;
                height: 24px;
            }
        }

        @media (min-width: 1280px) {
            .step-icon svg {
                width: 32px;
                height: 32px;
            }
        }

        .step-label {
            font-size: 10px;
            color: #cbd5e1;
            margin-top: 4px;
            text-align: center;
        }

        @media (min-width: 640px) {
            .step-label {
                font-size: 14px;
                margin-top: 8px;
            }
            .step-label.mobile-only {
                display: none;
            }
        }

        .step-label.desktop-only {
            display: none;
        }

        @media (min-width: 640px) {
            .step-label.desktop-only {
                display: block;
            }
            .step-label.mobile-only {
                display: none;
            }
        }

        .form-section {
            animation: fadeIn 0.5s ease-in-out;
        }

        .form-group {
            margin-bottom: 16px;
        }

        @media (min-width: 640px) {
            .form-group {
                margin-bottom: 24px;
            }
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        @media (min-width: 640px) {
            .form-grid {
                grid-template-columns: 1fr 1fr;
                gap: 16px;
            }
        }

        @media (min-width: 1024px) {
            .form-grid {
                gap: 24px;
            }
        }

        .form-grid.two-col {
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        @media (min-width: 640px) {
            .form-grid.two-col {
                gap: 16px;
            }
        }

        label {
            display: block;
            color: #e2e8f0;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        @media (min-width: 640px) {
            label {
                font-size: 16px;
            }
        }

        input, select {
            width: 100%;
            padding: 12px 16px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        @media (min-width: 640px) {
            input, select {
                padding: 16px;
                font-size: 16px;
            }
        }

        input::placeholder {
            color: #94a3b8;
        }

        input:focus, select:focus {
            outline: none;
            border-color: transparent;
            box-shadow: 0 0 0 2px #0ea5e9;
        }

        input.error {
            border-color: #ef4444;
        }

        select {
            appearance: none;
            cursor: pointer;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        option {
            background: #1e293b;
            color: white;
        }

        .error-message {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 4px;
            color: #ef4444;
            font-size: 12px;
        }

        @media (min-width: 640px) {
            .error-message {
                font-size: 14px;
            }
        }

        .error-icon {
            width: 16px;
            height: 16px;
        }

        .security-notice {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 12px;
            padding: 12px 16px;
            margin-bottom: 16px;
        }

        @media (min-width: 640px) {
            .security-notice {
                padding: 16px;
            }
        }

        .security-text {
            color: #bbf7d0;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (min-width: 640px) {
            .security-text {
                font-size: 14px;
            }
        }

        .security-icon {
            width: 16px;
            height: 16px;
            flex-shrink: 0;
        }

        .payment-info {
            background: rgba(14, 165, 233, 0.2);
            border: 1px solid rgba(14, 165, 233, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        @media (min-width: 640px) {
            .payment-info {
                padding: 24px;
            }
        }

        .payment-text {
            color: #bae6fd;
            font-size: 14px;
            margin-bottom: 12px;
        }

        @media (min-width: 640px) {
            .payment-text {
                font-size: 16px;
            }
        }

        .payment-number {
            font-weight: bold;
            color: #e0f2fe;
            font-size: 16px;
        }

        @media (min-width: 640px) {
            .payment-number {
                font-size: 18px;
            }
        }

        .payment-instruction {
            color: #bae6fd;
            font-size: 12px;
        }

        @media (min-width: 640px) {
            .payment-instruction {
                font-size: 14px;
            }
        }

        .order-summary {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(14, 165, 233, 0.5);
            border-radius: 12px;
            padding: 16px;
            color: #bae6fd;
            font-weight: 500;
            line-height: 1.6;
            white-space: pre-line;
            font-size: 14px;
        }

        @media (min-width: 640px) {
            .order-summary {
                padding: 24px;
                font-size: 16px;
            }
        }

        .summary-title {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            color: white;
            margin-bottom: 16px;
        }

        @media (min-width: 640px) {
            .summary-title {
                font-size: 20px;
                margin-bottom: 24px;
            }
        }

        @media (min-width: 1024px) {
            .summary-title {
                font-size: 24px;
            }
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 16px;
            gap: 12px;
        }

        @media (min-width: 640px) {
            .form-actions {
                padding-top: 24px;
                gap: 16px;
            }
        }

        .btn {
            padding: 10px 16px;
            border-radius: 25px;
            font-weight: bold;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 14px;
            min-width: 80px;
            touch-action: manipulation;
        }

        @media (min-width: 640px) {
            .btn {
                padding: 12px 24px;
                font-size: 16px;
                min-width: 100px;
            }
        }

        @media (min-width: 1024px) {
            .btn {
                padding: 16px 32px;
                min-width: 120px;
            }
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #475569;
            color: white;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #64748b;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2563eb, #0ea5e9);
            color: white;
            box-shadow: 0 10px 25px rgba(37, 99, 235, 0.25);
        }

        .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #1d4ed8, #0284c7);
            box-shadow: 0 15px 35px rgba(37, 99, 235, 0.35);
        }

        .btn-success {
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
            box-shadow: 0 10px 25px rgba(5, 150, 105, 0.25);
            min-width: 100px;
        }

        @media (min-width: 640px) {
            .btn-success {
                min-width: 120px;
            }
        }

        @media (min-width: 1024px) {
            .btn-success {
                min-width: 140px;
            }
        }

        .btn-success:hover:not(:disabled) {
            background: linear-gradient(135deg, #047857, #059669);
            box-shadow: 0 15px 35px rgba(5, 150, 105, 0.35);
        }

        .hidden {
            display: none;
        }

        .font-mono {
            font-family: ui-monospace, SFMono-Regular, "SF Mono", Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="home-btn" onclick="window.location.href='/'">
            <svg class="home-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m3 12 2-2m0 0 7-7 7 7M5 10v10a1 1 0 0 0 1 1h3m10-11 2 2m-2-2v10a1 1 0 0 1-1 1h-3m-6 0a1 1 0 0 0 1-1v-4a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v4a1 1 0 0 0 1 1m-6 0h6"></path>
            </svg>
            <span class="desktop-only">Home</span>
        </button>

        <h1 class="title">Order Your Service</h1>

        <div class="steps">
            <div class="step">
                <div class="step-icon" id="step-0">
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd" d="M2.625 6.75a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875 0A.75.75 0 0 1 8.25 6h8.25a.75.75 0 0 1 0 1.5H8.25a.75.75 0 0 1-.75-.75ZM2.625 12a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0ZM7.5 12a.75.75 0 0 1 .75-.75h8.25a.75.75 0 0 1 0 1.5H8.25A.75.75 0 0 1 7.5 12Zm-4.875 5.25a1.125 1.125 0 1 1 2.25 0 1.125 1.125 0 0 1-2.25 0Zm4.875 0a.75.75 0 0 1 .75-.75h8.25a.75.75 0 0 1 0 1.5H8.25a.75.75 0 0 1-.75-.75Z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <span class="step-label desktop-only">Service</span>
                <span class="step-label mobile-only">Serv</span>
            </div>
            <div class="step">
                <div class="step-icon" id="step-1">
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0ZM3.751 20.105a8.25 8.25 0 0 1 16.498 0 .75.75 0 0 1-.437.695A18.683 18.683 0 0 1 12 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 0 1-.437-.695Z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <span class="step-label desktop-only">Details</span>
                <span class="step-label mobile-only">Deta</span>
            </div>
            <div class="step">
                <div class="step-icon" id="step-2">
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path d="M4.5 3.75a3 3 0 0 0-3 3v.75h21v-.75a3 3 0 0 0-3-3h-15Z"></path>
                        <path fill-rule="evenodd" d="M22.5 9.75h-21v7.5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3v-7.5Zm-18 3.75a.75.75 0 0 1 .75-.75h6a.75.75 0 0 1 0 1.5h-6a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3a.75.75 0 0 0 0-1.5h-3Z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <span class="step-label desktop-only">Payment</span>
                <span class="step-label mobile-only">Pay</span>
            </div>
            <div class="step">
                <div class="step-icon" id="step-3">
                    <svg fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"></path>
                        <path fill-rule="evenodd" d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 0 1 0-1.113ZM17.25 12a5.25 5.25 0 1 1-10.5 0 5.25 5.25 0 0 1 10.5 0Z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <span class="step-label desktop-only">Review</span>
                <span class="step-label mobile-only">Rev</span>
            </div>
        </div>

        <form id="orderForm">
            <!-- Step 0: Service Selection -->
            <div id="form-step-0" class="form-section">
                <div class="form-group">
                    <label for="service">Choose a Service</label>
                    <select id="service" required>
                        <option value="" disabled selected>Select a service</option>
                        <option value="Logo Design">Logo Design - Rs. 200</option>
                        <option value="Graphic Design">Graphic Design - Rs. 150</option>
                        <option value="Presentation Design">Presentation Design - Rs. 100</option>
                        <option value="Web Development">Web Development - Rs. 3000</option>
                        <option value="Social Media Management">Social Media Management - Rs. 2000</option>
                    </select>
                </div>
            </div>

            <!-- Step 1: Customer Details -->
            <div id="form-step-1" class="form-section hidden">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="fullName">Full Name</label>
                        <input type="text" id="fullName" placeholder="Your full name" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" placeholder="you@example.com" required>
                        <div id="email-error" class="error-message hidden">
                            <svg class="error-icon" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path>
                            </svg>
                            <span id="email-error-text"></span>
                        </div>
                    </div>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="phone">Phone Number</label>
                        <input type="tel" id="phone" placeholder="+977-98XXXXXXXX" required>
                        <div id="phone-error" class="error-message hidden">
                            <svg class="error-icon" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path>
                            </svg>
                            <span id="phone-error-text"></span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="company">Company / Organization</label>
                        <input type="text" id="company" placeholder="Optional">
                    </div>
                </div>
                <div class="form-group">
                    <label for="dueDate">Preferred Due Date</label>
                    <input type="date" id="dueDate" required>
                </div>
            </div>

            <!-- Step 2: Payment Method -->
            <div id="form-step-2" class="form-section hidden">
                <div class="form-group">
                    <label for="paymentMethod">Payment Method</label>
                    <select id="paymentMethod" required>
                        <option value="" disabled selected>Select payment method</option>
                        <option value="credit-card">Credit Card</option>
                        <option value="esewa">eSewa</option>
                        <option value="pay-later">Pay Later</option>
                    </select>
                </div>

                <!-- Credit Card Fields -->
                <div id="credit-card-fields" class="hidden">
                    <div class="security-notice">
                        <p class="security-text">
                            <svg class="security-icon" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-7-4z"></path>
                            </svg>
                            Your payment information is encrypted and secure. Card details are never stored or transmitted via email.
                        </p>
                    </div>
                    <div class="form-group">
                        <label for="cardNumber">Card Number</label>
                        <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" class="font-mono">
                        <div id="cardNumber-error" class="error-message hidden">
                            <svg class="error-icon" fill="currentColor" viewBox="0 0 24 24">
                                <path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path>
                            </svg>
                            <span id="cardNumber-error-text"></span>
                        </div>
                    </div>
                    <div class="form-grid two-col">
                        <div class="form-group">
                            <label for="expiryDate">Expiry Date</label>
                            <input type="text" id="expiryDate" placeholder="MM/YY" maxlength="5" class="font-mono">
                            <div id="expiryDate-error" class="error-message hidden">
                                <svg class="error-icon" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path>
                                </svg>
                                <span id="expiryDate-error-text"></span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="cvv">CVV</label>
                            <input type="password" id="cvv" placeholder="123" maxlength="4" class="font-mono">
                            <div id="cvv-error" class="error-message hidden">
                                <svg class="error-icon" fill="currentColor" viewBox="0 0 24 24">
                                    <path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003ZM12 8.25a.75.75 0 0 1 .75.75v3.75a.75.75 0 0 1-1.5 0V9a.75.75 0 0 1 .75-.75Zm0 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clip-rule="evenodd"></path>
                                </svg>
                                <span id="cvv-error-text"></span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="billingAddress">Billing Address</label>
                        <input type="text" id="billingAddress" placeholder="Street, City, Country">
                    </div>
                </div>

                <!-- eSewa Fields -->
                <div id="esewa-fields" class="hidden">
                    <div class="payment-info">
                        <p class="payment-text">Please send payment to: <span class="payment-number">9766654639</span></p>
                        <p class="payment-instruction">Then enter your Transaction ID below:</p>
                    </div>
                    <div class="form-group">
                        <label for="esewaTransactionId">Transaction ID</label>
                        <input type="text" id="esewaTransactionId" placeholder="Transaction ID">
                    </div>
                </div>
            </div>

            <!-- Step 3: Order Summary -->
            <div id="form-step-3" class="form-section hidden">
                <h3 class="summary-title">Order Summary</h3>
                <div class="order-summary" id="orderSummary"></div>
            </div>

            <div class="form-actions">
                <button type="button" id="prevBtn" class="btn btn-secondary" disabled>Back</button>
                <button type="button" id="nextBtn" class="btn btn-primary">Next</button>
                <button type="submit" id="submitBtn" class="btn btn-success hidden">Submit Order</button>
            </div>
        </form>
    </div>

    <script>
        // Initialize EmailJS
        emailjs.init("v-TBqWppfClYlat8A");

        // Form state
        let currentStep = 0;
        let isSubmitting = false;
        const validationErrors = {};

        const services = [
            { value: "Logo Design", price: 200 },
            { value: "Graphic Design", price: 150 },
            { value: "Presentation Design", price: 100 },
            { value: "Web Development", price: 3000 },
            { value: "Social Media Management", price: 2000 }
        ];

        // Utility functions
        function formatCardNumber(value) {
            const v = value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            const matches = v.match(/\d{4,16}/g);
            const match = (matches && matches[0]) || '';
            const parts = [];
            for (let i = 0, len = match.length; i < len; i += 4) {
                parts.push(match.substring(i, i + 4));
            }
            if (parts.length) {
                return parts.join(' ');
            } else {
                return v;
            }
        }

        function formatExpiryDate(value) {
            const v = value.replace(/\s+/g, '').replace(/[^0-9]/gi, '');
            if (v.length >= 2) {
                return v.substring(0, 2) + '/' + v.substring(2, 4);
            }
            return v;
        }

        function validateCardNumber(cardNumber) {
            const cleaned = cardNumber.replace(/\s/g, '');
            if (cleaned.length < 13 || cleaned.length > 19) {
                return 'Card number must be between 13-19 digits';
            }
            // Luhn algorithm
            let sum = 0;
            let isEven = false;
            for (let i = cleaned.length - 1; i >= 0; i--) {
                let digit = parseInt(cleaned.charAt(i), 10);
                if (isEven) {
                    digit *= 2;
                    if (digit > 9) {
                        digit -= 9;
                    }
                }
                sum += digit;
                isEven = !isEven;
            }
            return sum % 10 === 0 ? '' : 'Invalid card number';
        }

        function validateExpiryDate(expiryDate) {
            if (!/^\d{2}\/\d{2}$/.test(expiryDate)) {
                return 'Invalid format (MM/YY)';
            }
            const [month, year] = expiryDate.split('/').map(Number);
            if (month < 1 || month > 12) {
                return 'Invalid month';
            }
            const currentDate = new Date();
            const currentYear = currentDate.getFullYear() % 100;
            const currentMonth = currentDate.getMonth() + 1;
            if (year < currentYear || (year === currentYear && month < currentMonth)) {
                return 'Card has expired';
            }
            return '';
        }

        function validateCVV(cvv) {
            if (!/^\d{3,4}$/.test(cvv)) {
                return 'CVV must be 3-4 digits';
            }
            return '';
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email) ? '' : 'Invalid email address';
        }

        function validatePhone(phone) {
            const phoneRegex = /^[+]?[0-9\-\s()]{10,}$/;
            return phoneRegex.test(phone) ? '' : 'Invalid phone number';
        }

        function showError(field, message) {
            const errorElement = document.getElementById(`${field}-error`);
            const errorTextElement = document.getElementById(`${field}-error-text`);
            const inputElement = document.getElementById(field);
            
            if (message) {
                validationErrors[field] = message;
                if (errorElement && errorTextElement) {
                    errorTextElement.textContent = message;
                    errorElement.classList.remove('hidden');
                }
                if (inputElement) {
                    inputElement.classList.add('error');
                }
            } else {
                delete validationErrors[field];
                if (errorElement) {
                    errorElement.classList.add('hidden');
                }
                if (inputElement) {
                    inputElement.classList.remove('error');
                }
            }
        }

        function updateStepIcons() {
            for (let i = 0; i <= 3; i++) {
                const stepIcon = document.getElementById(`step-${i}`);
                stepIcon.className = 'step-icon';
                
                if (i < currentStep) {
                    stepIcon.classList.add('active');
                } else if (i === currentStep) {
                    stepIcon.classList.add('active', 'current');
                } else {
                    stepIcon.classList.add('inactive');
                }
            }
        }

        function showStep(step) {
            // Hide all steps
            for (let i = 0; i <= 3; i++) {
                document.getElementById(`form-step-${i}`).classList.add('hidden');
            }
            
            // Show current step
            document.getElementById(`form-step-${step}`).classList.remove('hidden');
            
            // Update buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const submitBtn = document.getElementById('submitBtn');
            
            prevBtn.disabled = step === 0;
            
            if (step < 3) {
                nextBtn.classList.remove('hidden');
                submitBtn.classList.add('hidden');
            } else {
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
            }
            
            updateStepIcons();
        }

        function validateStep(step) {
            switch (step) {
                case 0:
                    return document.getElementById('service').value !== '';
                case 1:
                    const fullName = document.getElementById('fullName').value;
                    const email = document.getElementById('email').value;
                    const phone = document.getElementById('phone').value;
                    const dueDate = document.getElementById('dueDate').value;
                    return fullName && email && phone && dueDate && 
                           !validationErrors.email && !validationErrors.phone;
                case 2:
                    const paymentMethod = document.getElementById('paymentMethod').value;
                    if (!paymentMethod) return false;
                    
                    if (paymentMethod === 'credit-card') {
                        const cardNumber = document.getElementById('cardNumber').value;
                        const expiryDate = document.getElementById('expiryDate').value;
                        const cvv = document.getElementById('cvv').value;
                        return cardNumber && expiryDate && cvv && 
                               !validationErrors.cardNumber && !validationErrors.expiryDate && !validationErrors.cvv;
                    }
                    
                    if (paymentMethod === 'esewa') {
                        return document.getElementById('esewaTransactionId').value !== '';
                    }
                    
                    return true;
                default:
                    return true;
            }
        }

        function updateOrderSummary() {
            const service = document.getElementById('service').value;
            const fullName = document.getElementById('fullName').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const company = document.getElementById('company').value || 'N/A';
            const dueDate = document.getElementById('dueDate').value;
            const paymentMethod = document.getElementById('paymentMethod').value;
            
            const selectedService = services.find(s => s.value === service);
            let paymentDisplay = paymentMethod;
            
            if (paymentMethod === 'credit-card') {
                const cardNumber = document.getElementById('cardNumber').value;
                paymentDisplay = `Credit Card (****${cardNumber.slice(-4)})`;
            } else if (paymentMethod === 'esewa') {
                const transactionId = document.getElementById('esewaTransactionId').value;
                paymentDisplay = `eSewa (${transactionId})`;
            }
            
            const summary = `Service: ${service} (Rs. ${selectedService?.price || 0})
Name: ${fullName}
Email: ${email}
Phone: ${phone}
Company: ${company}
Due Date: ${dueDate}
Payment Method: ${paymentDisplay}`;
            
            document.getElementById('orderSummary').textContent = summary;
        }

        // Event listeners
        document.getElementById('prevBtn').addEventListener('click', () => {
            if (currentStep > 0) {
                currentStep--;
                showStep(currentStep);
            }
        });

        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentStep < 3 && validateStep(currentStep)) {
                if (currentStep === 2) {
                    updateOrderSummary();
                }
                currentStep++;
                showStep(currentStep);
            }
        });

        // Payment method change handler
        document.getElementById('paymentMethod').addEventListener('change', (e) => {
            const creditCardFields = document.getElementById('credit-card-fields');
            const esewaFields = document.getElementById('esewa-fields');
            
            creditCardFields.classList.add('hidden');
            esewaFields.classList.add('hidden');
            
            if (e.target.value === 'credit-card') {
                creditCardFields.classList.remove('hidden');
            } else if (e.target.value === 'esewa') {
                esewaFields.classList.remove('hidden');
            }
        });

        // Input validation handlers
        document.getElementById('cardNumber').addEventListener('input', (e) => {
            const formatted = formatCardNumber(e.target.value);
            e.target.value = formatted;
            if (formatted) {
                const error = validateCardNumber(formatted);
                showError('cardNumber', error);
            }
        });

        document.getElementById('expiryDate').addEventListener('input', (e) => {
            const formatted = formatExpiryDate(e.target.value);
            e.target.value = formatted;
            if (formatted.length === 5) {
                const error = validateExpiryDate(formatted);
                showError('expiryDate', error);
            }
        });

        document.getElementById('cvv').addEventListener('input', (e) => {
            const value = e.target.value.replace(/[^0-9]/g, '').substring(0, 4);
            e.target.value = value;
            if (value.length >= 3) {
                const error = validateCVV(value);
                showError('cvv', error);
            }
        });

        document.getElementById('email').addEventListener('input', (e) => {
            if (e.target.value) {
                const error = validateEmail(e.target.value);
                showError('email', error);
            }
        });

        document.getElementById('phone').addEventListener('input', (e) => {
            if (e.target.value) {
                const error = validatePhone(e.target.value);
                showError('phone', error);
            }
        });

        // Form submission
        document.getElementById('orderForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (isSubmitting) return;
            isSubmitting = true;
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.textContent = 'Submitting...';
            submitBtn.disabled = true;
            
            try {
                const service = document.getElementById('service').value;
                const selectedService = services.find(s => s.value === service);
                const paymentMethod = document.getElementById('paymentMethod').value;
                
                let paymentReference = 'Pay Later';
                if (paymentMethod === 'credit-card') {
                    const cardNumber = document.getElementById('cardNumber').value;
                    paymentReference = `Card ending in ${cardNumber.slice(-4)}`;
                } else if (paymentMethod === 'esewa') {
                    const transactionId = document.getElementById('esewaTransactionId').value;
                    paymentReference = `eSewa Transaction: ${transactionId}`;
                }
                
                const templateParams = {
                    service: service,
                    price: selectedService?.price || 0,
                    name: document.getElementById('fullName').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value,
                    company: document.getElementById('company').value || 'N/A',
                    due_date: document.getElementById('dueDate').value,
                    payment: paymentMethod,
                    payment_reference: paymentReference
                };
                
                await emailjs.send('mrbhusal', 'template_y8zhuoi', templateParams);
                
                alert('✅ Order submitted successfully! Thank you for your secure payment.');
                
                // Reset form
                document.getElementById('orderForm').reset();
                currentStep = 0;
                showStep(currentStep);
                Object.keys(validationErrors).forEach(key => delete validationErrors[key]);
                
            } catch (error) {
                console.error('EmailJS error:', error);
                alert('❌ Failed to send order. Please try again later.');
            } finally {
                isSubmitting = false;
                submitBtn.textContent = 'Submit Order';
                submitBtn.disabled = false;
            }
        });

        // Initialize
        showStep(0);
    </script>
</body>
</html>
